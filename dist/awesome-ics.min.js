var Awesome={};module.exports=Awesome,Awesome.Constants={format:{newLine:"\n",blockBegin:"BEGIN:",blockEnd:"END:",separatorProp:":",separatorParam:";",separatorValue:"=",whitespace:" "},regex:{blockBegin:/^BEGIN:/i,blockEnd:/^END:/i,separator:/.+:.+/i}},Awesome.Util={trim:function(a){var b=Awesome.Util.removePattern(a,/^\s+/g);return Awesome.Util.removePattern(b,/\s+$/g)},removePattern:function(a,b){return a.replace(b,"")},mapToString:function(a){return a.toString()},mapToJSON:function(a){return a.toJSON()},setError:function(a,b){a.error=b},mergeElements:function(a,b){for(var c=0;c<a.length;){var d=a[c],e=a[c+1];c==a.length-1||b&&b(d,e)?c++:a.splice(c,2,[d,e].join(""))}return a.filter(function(a){return a})},splitSafe:function(a,b){return Awesome.Util.mergeElements(a.split(b),function(a){var b=a.match(/"/g);return!b||b.length%2===0})},splitSafeLines:function(a){return Awesome.Util.mergeElements(a.split(Awesome.Constants.format.newLine),function(a,b){return" "!==b[0]})}},Awesome.Calendar=function(){var a=this,b=new Awesome.Block;a.loadFromText=function(c){return b.loadFromText(c),a},a.toString=function(){return b&&b.toString()||""},a.toJSON=function(){return b.toJSON()||{}}},Awesome.Block=function(){var a=this;a.children=[],a.prop=[];var b=function(b){if(0===b.length)return Awesome.Util.setError(a,"Cannot load Awesome.Block, it should end with /^END:/i statement."),0;var c=-1,d=!1;return b.forEach(function(e,f){if(e=Awesome.Util.trim(e),!(d||c>f)){if(Awesome.Constants.regex.blockBegin.test(e)){var g=new Awesome.Block,h=b.slice(f).join(Awesome.Constants.format.newLine);return c=g.loadFromText(h)+f,void a.children.push(g)}if(f>c&&(c=f),Awesome.Constants.regex.blockEnd.test(e)){var i=Awesome.Util.removePattern(e,Awesome.Constants.regex.blockEnd);return d=!0,void(i!==a.type&&Awesome.Util.setError(a,"Type of Awesome.Block BEGIN does not match END. Expected: "+a.type+" Actual: "+i))}a.prop.push((new Awesome.Property).loadFromText(e))}}),c+1};a.loadFromText=function(c){var d=Awesome.Util.splitSafeLines(c),e=Awesome.Util.trim(d[0]||"");if(!Awesome.Constants.regex.blockBegin.test(e))return Awesome.Util.setError(a,"Cannot load Awesome.Block, last line should start with /^BEGIN:/i in first line."),0;a.type=Awesome.Util.removePattern(e,Awesome.Constants.regex.blockBegin);var f=d.slice(1);return b(f)+1},a.toString=function(){if(a.error)return a.error;var b="";a.prop.length&&(b=a.prop.map(Awesome.Util.mapToString).join(Awesome.Constants.format.newLine)+Awesome.Constants.format.newLine);var c="";return a.children.length&&(c=a.children.map(Awesome.Util.mapToString).join(Awesome.Constants.format.newLine)+Awesome.Constants.format.newLine),Awesome.Constants.format.blockBegin+a.type+Awesome.Constants.format.newLine+b+c+Awesome.Constants.format.blockEnd+a.type},a.toJSON=function(){return a.error?{error:a.error}:{type:a.type,prop:a.prop.map(Awesome.Util.mapToJSON),children:a.children.map(Awesome.Util.mapToJSON)}}},Awesome.Property=function(){var a=this;a.name=null,a.value=null,a.params=[],a.valueType=null,a.loadFromText=function(b){a.name=Awesome.Util.splitSafe(b,Awesome.Constants.format.separatorProp)[0];var c=Awesome.Util.trim(b.slice(a.name.length+1));if(-1!==a.name.indexOf(Awesome.Constants.format.separatorParam)){var d=Awesome.Util.splitSafe(a.name,Awesome.Constants.format.separatorParam);a.name=d[0],a.params=d.slice(1).map(function(a){return(new Awesome.PropertyParameter).loadFromText(a)})}var e=Awesome.Property.ValueType.Mappings.get(a.name,a.params);return a.value=(new e).loadFromText(c),a},a.toString=function(){var b=a.name;if(a.params.length){var c=a.params.map(Awesome.Util.mapToString).join(Awesome.Constants.format.separatorParam);b=[b,c].join(Awesome.Constants.format.separatorParam)}return b+Awesome.Constants.format.separatorProp+a.value},a.toJSON=function(){return{name:a.name,value:a.value,params:a.params.map(Awesome.Util.mapToJSON)}}},Awesome.PropertyParameter=function(){var a=this;a.name=null,a.value=null,a.loadFromText=function(b){return a.name=Awesome.Util.splitSafe(b,Awesome.Constants.format.separatorValue)[0],a.value=Awesome.Util.trim(b.slice(a.name.length+1)),a},a.toString=function(){return a.name+Awesome.Constants.format.separatorValue+a.value},a.toJSON=function(){return{name:a.name,value:a.value}}},Awesome.Property.Params=["ALTREP","CN","CUTYPE","DELEGATED-FROM","DELEGATED-TO","DIR","ENCODING","FMTTYPE","FBTYPE","LANGUAGE","MEMBER","PARTSTAT","RANGE","RELATED","RELTYPE","ROLE","RSVP","SENT-BY","TZID","VALUE"],Awesome.Property.ValueType={},Awesome.Property.ValueType.Binary=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.Boolean=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.CalendarUserAddress=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.Date=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.DateTime=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.Duration=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.Float=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.Geo=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.Integer=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.PeriodOfTime=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.RecurrenceRule=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.Text=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.Time=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.URI=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.UTCOffset=function(){var a=this;a.value=null,a.loadFromText=function(b){return a.value=b,a},a.toString=function(){return a.value},a.toJSON=function(){return a.value}},Awesome.Property.ValueType.Mappings={CALSCALE:Awesome.Property.ValueType.Text,METHOD:Awesome.Property.ValueType.Text,PRODID:Awesome.Property.ValueType.Text,VERSION:Awesome.Property.ValueType.Text,ATTACH:[Awesome.Property.ValueType.URI,Awesome.Property.ValueType.Binary],CATEGORIES:Awesome.Property.ValueType.Text,CLASS:Awesome.Property.ValueType.Text,COMMENT:Awesome.Property.ValueType.Text,DESCRIPTION:Awesome.Property.ValueType.Text,GEO:Awesome.Property.ValueType.Geo,LOCATION:Awesome.Property.ValueType.Text,"PERCENT-COMPLETE":Awesome.Property.ValueType.Integer,PRIORITY:Awesome.Property.ValueType.Integer,RESOURCES:Awesome.Property.ValueType.Text,STATUS:Awesome.Property.ValueType.Text,SUMMARY:Awesome.Property.ValueType.Text,COMPLETED:Awesome.Property.ValueType.DateTime,DTEND:[Awesome.Property.ValueType.DateTime,Awesome.Property.ValueType.Date],DUE:[Awesome.Property.ValueType.DateTime,Awesome.Property.ValueType.Date],DTSTART:[Awesome.Property.ValueType.DateTime,Awesome.Property.ValueType.Date],DURATION:Awesome.Property.ValueType.Duration,FREEBUSY:Awesome.Property.ValueType.PeriodOfTime,TRANSP:Awesome.Property.ValueType.Text,TZID:Awesome.Property.ValueType.Text,TZNAME:Awesome.Property.ValueType.Text,TZOFFSETFROM:Awesome.Property.ValueType.UTCOffset,TZOFFSETTO:Awesome.Property.ValueType.UTCOffset,TZURL:Awesome.Property.ValueType.URI,ATTENDEE:Awesome.Property.ValueType.CalendarUserAddress,CONTACT:Awesome.Property.ValueType.Text,ORGANIZER:Awesome.Property.ValueType.CalendarUserAddress,"RECURRENCE-ID":[Awesome.Property.ValueType.DateTime,Awesome.Property.ValueType.Date],"RELATED-TO":Awesome.Property.ValueType.Text,URL:Awesome.Property.ValueType.URI,UID:Awesome.Property.ValueType.Text,EXDATE:[Awesome.Property.ValueType.DateTime,Awesome.Property.ValueType.Date],RDATE:[Awesome.Property.ValueType.DateTime,Awesome.Property.ValueType.Date,Awesome.Property.ValueType.PeriodOfTime],RRULE:Awesome.Property.ValueType.RecurrenceRule,ACTION:Awesome.Property.ValueType.Text,REPEAT:Awesome.Property.ValueType.Integer,TRIGGER:[Awesome.Property.ValueType.Duration,Awesome.Property.ValueType.DateTime],CREATED:Awesome.Property.ValueType.DateTime,DTSTAMP:Awesome.Property.ValueType.DateTime,"LAST-MODIFIED":Awesome.Property.ValueType.DateTime,SEQUENCE:Awesome.Property.ValueType.Integer,"REQUEST-STATUS":Awesome.Property.ValueType.Text,DEFAULT:Awesome.Property.ValueType.Text,get:function(a,b){var c=Awesome.Property.ValueType.Mappings[a]||Awesome.Property.ValueType.Mappings.DEFAULT;return Array.isArray(c)?c[0]:c}};